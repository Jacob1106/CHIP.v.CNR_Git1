```{R, "Source Code"}

source("/Volumes/groups/bakergrp/projects/baker_data/bakergrp/analyses/JM/ChIP.v.CnR/GeneralR_script_CHIP_CUT/Myfunctions.R")

```

```{R, "CTCF analysis"}

file_list_CTCF <- list(
    CNR42 = "/Volumes/groups/bakergrp/projects/baker_data/bakergrp/analyses/JM/CHIP.v.CNR_Git1/UnifiedPeakCalling/CNR_CTCF_PeakCalling/CNR_CTCF_42_PeakCalls_peaks.narrowPeak",
    CNR99 = "/Volumes/groups/bakergrp/projects/baker_data/bakergrp/analyses/JM/CHIP.v.CNR_Git1/UnifiedPeakCalling/CNR_CTCF_PeakCalling/CNR_CTCF_99_PeakCalls_peaks.narrowPeak",
    CHIP42 = "/Volumes/groups/bakergrp/projects/baker_data/bakergrp/analyses/JM/CHIP.v.CNR_Git1/UnifiedPeakCalling/CHIP_CTCF_PeakCalling/CHIP_CTCF_42_PeakCalls_peaks.narrowPeak",
    CHIP99 = "/Volumes/groups/bakergrp/projects/baker_data/bakergrp/analyses/JM/CHIP.v.CNR_Git1/UnifiedPeakCalling/CHIP_CTCF_PeakCalling/CHIP_CTCF_99_PeakCalls_peaks.narrowPeak"
)
data_CTCF <- import_samples(file_list_CTCF)

```

```{R}

pValueList_CTCF <- list(
    CHIP42 = data_CTCF$CHIP42$pValue[which(data_CTCF$CHIP42$pValue < 11)],
    CHIP99 = data_CTCF$CHIP99$pValue[which(data_CTCF$CHIP99$pValue < 11)],
    CNR42 = data_CTCF$CNR42$pValue[which(data_CTCF$CNR42$pValue < 11)], 
    CNR99 = data_CTCF$CNR99$pValue[which(data_CTCF$CNR99$pValue < 11)] 
)
df_CTCF <- do.call(rbind, lapply(names(pValueList_CTCF), function(x) {
  data.frame(sample = x, value = pValueList_CTCF[[x]])
}))

pValue_Plot_sampleXsample_CTCF <-ggplot(df_CTCF, aes(x = value, colour = sample))+
    geom_density(linewidth = 1.2)+
    geom_vline(xintercept = 4, color = "black", linetype = "dashed", linewidth = 1) +
    annotate("text", x = 4, y = 0.6, label = "log10(p) = 4 (Filtering Cut Off of 0.0001)", 
           angle = 90, vjust = -0.5, hjust = 1.2, size = 5, fontface = "bold") +
    theme_minimal(base_size = 16)+
    theme(
        plot.title = element_text(size = 12, face = "bold"),  # main title
        axis.title = element_text(size = 18, face = "bold"),  # x & y titles
        axis.text = element_text(size = 14),                  # tick labels
        legend.text = element_text(size = 14),                # legend text
        legend.title = element_text(size = 16, face = "bold") # legend title
    )+
    labs(title = "Variance between Samples in CTCF: Using Different Peak Calling (1)", x = "-log10(pvalue)")
ggsave("/Volumes/groups/bakergrp/projects/baker_data/bakergrp/analyses/JM/CHIP.v.CNR_Git1/CTCF_Analysis_NewPeakCalling/PValue/Plots/PValuePlot_CTCF.png", pValue_Plot_sampleXsample_CTCF, height = 7, width = 7, dpi = 300)
pValue_Plot_sampleXsample_CTCF
```

```{R}
pValue_Plot_sampleXsample_CTCF1 <- readRDS("/Volumes/JM/CHIP.v.CNR_Git1/PValue/Plots/PValuePlot.rds")

pValue_Plot_sampleXsample_CTCF1
list <- list(pValue_Plot_sampleXsample_CTCF, pValue_Plot_sampleXsample_CTCF1)
combined <- wrap_plots(list, ncol = 2)

ggsave("/Volumes/JM/CHIP.v.CNR_Git1/CTCF_Analysis_NewPeakCalling/PValue/Plots/MergedPvaluePlotBetweenNewPeakAndOldPeaks.png", combined, height = 7, width = 12, dpi = 300)
```